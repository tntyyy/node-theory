# None blocking I/O (Концепция неблокирующего ввода/вывода)

### Первый основной поток:

- Главный поток не блокается
- Сервер будет продолжать обслуживать запросы
- Работаем с async кодом

## Схема работы

- Приходит запрос
- Обрабатывается
- Движок V8 начинает работу
- Node Bindings к-е позволят преобразовать код к нек-ым Events
- Event попадает в Event Queue
- Event loop берет события из очереди и отправляет в Callstack
- В callstack`e начинает выполняться js код, на движке v8. Если callstack встречает что-то что требует производительности (чтение файлов, сет таймауты и т.д) он отправляет их в Worker Threads (отдельные потоки, к-е выполняют сложные операции), и после отправки сложной операции в Worker Threads продолжает выполнять свои "простые" операции
- После того как Worker завершил работу он передает колбек обратно в очередь вызовов.
- Если после всей этой карусели мы можем вернуть ответ, то event loop возвращает его обратно в node bildings -> v8 -> сам ответ

_По сути Event loop это просто цикл, который имеет набор фаз, который забирает из очереди какие то события -> отправляет их на выполнение (если операция тяжелая, то выполнение будет делегировано worker`ам). В результате в основном потоке, будут выполняться незначительные операции, которые не блокируют поток_

# Как устроен Event Loop и какие у него есть фазы

- Timer – обрабатываем все колбэки setTimeout() и setInterval().

- Pending callbacks – эта фаза выполняет обратные вызовы для некоторых системных операций, например, ошибки TCP.

- Idle, prepare – это системные фазы, у нас нет к ним доступа, Node.js сама их вызывает ( особо нас не интересует).

- Poll – занимается обработкой I/O операций.

- Check – выполняет колбэки setImmediate().

- Close callbacks – выполняются события ‘close’, socket.on(‘close’)

### Отдельно есть так называемые микротаски:

- NextTickQueue – выполняются вызовы process.nextTick()

- Other microtasks queue – в основном здесь выполняются Promise.

Данные микротаски выполняются, если цикл событий не находится в одной из 6 вышеописанных фаз
